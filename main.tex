\documentclass[journal]{IEEEtran}

\usepackage{adjustbox}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{array}
\usepackage{circuitikz}
\usepackage{cite}
\usepackage{colortbl}
\usepackage{environ}
\usepackage{grffile}
\usepackage{hyperref}
\usepackage{import}
\usepackage{mathtools}
\usepackage{microtype}
\usepackage{multirow}
\usepackage{pgffor}
\usepackage{pgfplots}
\usepackage{physics}
\usepackage{siunitx}
\usepackage{stfloats}
\usepackage{tikz}
\usepackage{url}
\usepackage{xcolor}
\usepackage[T1]{fontenc}
\usepackage[caption=false,font=footnotesize,subrefformat=parens,labelformat=parens]{subfig}
\usepackage[short]{optidef}
% \usepackage[subtle]{savetrees}


\interdisplaylinepenalty=2500
\pgfplotsset{compat=newest}
\usepgfplotslibrary{patchplots}
\newtheorem{proposition}{Proposition}
\newtheorem{remark}{Remark}
\DeclareSIUnit{\belm}{Bm}
\DeclareSIUnit{\dBm}{\deci\belm}
\DeclareSIUnit{\beli}{Bi}
\DeclareSIUnit{\dBi}{\deci\beli}
\ctikzset{american}
\usetikzlibrary{arrows,calc,matrix,patterns,positioning}

\makeatletter
\tikzset{
	block/.style={draw,rectangle,align=center},
    from/.style args={#1 to #2}{
        above right={0cm of #1},
        /utils/exec=\pgfpointdiff
            {\tikz@scan@one@point\pgfutil@firstofone(#1)\relax}
            {\tikz@scan@one@point\pgfutil@firstofone(#2)\relax},
        minimum width/.expanded=\the\pgf@x,
        minimum height/.expanded=\the\pgf@y
	}
}
\makeatother

\algrenewcommand{\algorithmicwhile}{\textbf{While}}
\algrenewcommand{\algorithmicif}{\textbf{If}}
\algrenewcommand{\algorithmicthen}{\textbf{Then}}
\algrenewcommand{\algorithmicelse}{\textbf{Else}}
\algrenewcommand{\algorithmicend}{\textbf{End}}
\algrenewcommand{\algorithmicrepeat}{\textbf{Repeat}}
\algrenewcommand{\algorithmicuntil}{\textbf{Until}}


\begin{document}
	\title{Backscatter Modulation Design for Symbiotic Radio Networks}
	\maketitle

	\begin{section}{Backscatter Model}
		\begin{subsection}{Backscatter Principles}
			\begin{figure}[!t]
				\centering
				\subfloat[Block diagram]{
					\resizebox{0.6\columnwidth}{!}{
						\begin{circuitikz}[transform shape]
							\coordinate (O) at (0,0);
							\node[block,from={O to $(O) + (6.375,3.25)$}](T){};
							\draw (0,1.75)
								to[short] ++(-1,0)
								to[short] ++(0,0.75) node[bareantenna](A){Ant};
							\draw (0,1.75)
								to[short,-*] ++(0.25,0) coordinate(J);
							\draw (J)
								to[short] ++(0,1)
								to[short] ++(0.5,0) coordinate(J1);
							\node[block,from={$(J1) + (0,-0.25)$ to $(J1) + (2.5,0.25)$}](R){Rectifier};
							\draw (J)
								to[short] ++(0.5,0) coordinate(J2);
							\node[block,from={$(J2) + (0,-0.25)$ to $(J2) + (2.5,0.25)$}](D){Demodulator};
							\draw (J)
								to[short] ++(0,-1)
								to[short] ++(0.5,0) coordinate(J3)
								to [vR,mirror,invert,/tikz/circuitikz/bipoles/length=1cm] ++(1.75,0) node[ground,rotate=90]{};
							\node[block,from={$(J3) + (0,-0.25)$ to $(J3) + (2.5,0.25)$},draw=none](M){};
							\draw ($(J3) + (0,-0.25)$) rectangle ($(J3) + (2.5,0.25)$);
							\draw ($(J3) + (1.25,-0.5)$) node[]{Modulator};
							\draw[-{Latex[length=2mm]}] (R.east) -- ++(0.75,0);
							\draw[-{Latex[length=2mm]}] (D.east) -- ++(0.75,0);
							\draw[{Latex[length=2mm]}-] (M.east) -- ++(0.75,0);
							\node[block,from={$(R.east) + (0.75,-0.25)$ to $(R.east) + (2.875,0.25)$}](P){Power buffer};
							\node[block,from={$(M.east) + (0.75,-0.25)$ to $(D.east) + (2.875,0.25)$}](S){Digital\\section};
							\draw[dashed,-{Latex[length=2mm]}] (P.south) to (S.north);
							\coordinate (F1) at ($(P.south)!0.5!(S.north)$);
							\coordinate (F2) at ($(D.east)!0.5!(S.west)$);
							\coordinate (F3) at ($(D.south)!0.5!(M.north)$);
							\draw[dashed] (F1) to (F1-|D.north);
							\draw[dashed,-{Latex[length=2mm]}] (F1-|D.north) to (D.north);
							\draw[dashed] (F1-|F2) to (F2|-F3) to (M|-F3);
							\draw[dashed,-{Latex[length=2mm]}] (M|-F3) to (M.north);
						\end{circuitikz}
					}
					\label{fi:block_diagram}
				}
				\subfloat[One-port network model]{
					\resizebox{0.35\columnwidth}{!}{
						\begin{circuitikz}[transform shape]
							\draw (0,0) node[bareantenna](bareantenna){};
							\draw (bareantenna.west) ++(-1.5,0) node[waves](WI){};
							\draw (WI.north east) ++(0.25,0) node[font=\Large]{$\vec{E}_{\mathrm{I}}$};
							\draw (WI.south east) ++(0.25,0) node[font=\Large]{$\vec{H}_{\mathrm{I}}$};
							\draw (bareantenna.east) ++(0.875,0) node[waves](WR){};
							\draw (WR.north east) ++(0.25,0) node[font=\Large]{$\vec{E}_m$};
							\draw (WR.south east) ++(0.25,0) node[font=\Large]{$\vec{H}_m$};
							\draw (bareantenna)
								to [R=$Z_{\mathrm{A}}$,font=\Large,/tikz/circuitikz/bipoles/length=1cm] ++(0,-2)
								to [R=$Z_m$,font=\Large,/tikz/circuitikz/bipoles/length=1cm] ++(2,0) node[ground]{};
						\end{circuitikz}
					}
					\label{fi:one_port_network_model}
				}
				\caption{For a passive tag, the rectifier and demodulator rely on the incident electromagnetic wave for energy harvesting and downlink information decoding, while the load-switcher manipulate the reradiated signal for backscatter modulation.}
				\label{fi:tag}
			\end{figure}
			Consider a bistatic backscatter system that consists of an excitation source, a dedicated reader, and a passive tag. The excitation source generates a carrier wave signal, the dedicated reader decodes the tag message, and the tag simultaneously harvests energy, backscatters its own message, and demodulates the downlink information if necessary. As shown in Fig.~\subref*{fi:block_diagram}, a typical passive tag consists of a scattering antenna, an energy harvester, a integrated receiver\footnote{For example, \cite{Kim2021a} prototyped a compact-size pulse position demodulator based on an envelope detector, which brings great potential to coordination, synchronization, and reflection pattern control.}, a load-switching modulator, and on-chip components (e.g., micro-controller, memory, and sensors). A portion of the impinging signal is absorbed by the tag while the remaining is backscattered to the space, as illustrated in Fig.~\subref*{fi:one_port_network_model}. According to Green's decomposition \cite{Hansen1989}, the backscattered signal can be decomposed into the \emph{structural mode} component and the \emph{antenna mode} component. The former is fixed and depends on the antenna geometry and material properties\footnote{We assume the structural mode reflection can be modeled as part of the environment multipath and covered by channel estimation \cite{Boyer2014}.}, while the latter is adjustable and depends on the mismatch of the antenna and load impedance. Hence, the equivalent reflection coefficient at tag state $m$ is defined as\footnote{We assume the linear backscatter model where $\Gamma_m$ is irrelevant to the incident electromagnetic field at the tag \cite{Dobkin2012}.}
			\begin{equation}
				\Gamma_m = \frac{Z_m - Z_{\mathrm{A}}^*}{Z_m + Z_{\mathrm{A}}},
				\label{eq:reflection_coefficient}
			\end{equation}
			where $Z_m$ is the load impedance at state $m$ and $Z_{\mathrm{A}}$ is the antenna input impedance.
			\begin{remark}
				The reflection coefficient plays an important role in various network designs. For example, $\Gamma_m = 0$ (perfect matching) achieves maximum power transfer that is optimal for Wireless Power Transfer (WPT), $\lvert \Gamma_m \rvert = 1$ (perfect mismatching) achieves fully signal reflection that is optimal for Intelligent Reflecting Surface (IRS), and $\Gamma_m \ne \Gamma_{m'}$ (adjustable matching) enables backscatter modulation.
			\end{remark}
		\end{subsection}

		\begin{subsection}{Backscatter Modulation}
			Tags perform backscatter modulation by switching the load impedance between different states. Consider an $M$-ary Phase Shift Keying (PSK). At tag state $m \in \mathcal{M} \triangleq \{1,\ldots,M\}$, the reflection coefficient $\Gamma_m$ maps to the desired signal constellation point $c_m$ as \cite{Thomas2012a}
			\begin{equation}
				\Gamma_m = \alpha c_m = \alpha e^{\jmath \theta_m},
				\label{eq:backscatter_modulation}
			\end{equation}
			where $\alpha \in [0,1]$ is the reflection efficiency at a given direction, and $\theta_m \triangleq 2 \pi m / M$ is the phase of the $m$-th constellation point of $M$-PSK.
			\begin{remark}
				For passive tags, the reflection efficiency $\alpha$ controls the tradeoff between the backscatter strength and harvestable power. Interestingly, when $\alpha = 1$, the reflection coefficient set $\{\Gamma_m\}$ of the $M$-PSK backscatter coincides with that of an ideal discrete $M$-state uniform IRS. The optimal strategy for the IRS is to choose one reflection state with probability \num{1} to boost the equivalent channel, while the optimal strategy for the modulator is to utilize all constellation points with equal probability. It inspires one to adaptively design the probability mass function of tag symbols to jointly benefit the backscatter modulation and passive beamforming.
			\end{remark}
		\end{subsection}
	\end{section}

	\begin{section}{System Model}
		\begin{figure}[!t]
			\centering
			\def\svgwidth{0.9\columnwidth}
			\import{assets/}{symbiotic_radio.pdf_tex}
			\caption{A single-user single-tag symbiotic radio system.}
			\label{fi:symbiotic_radio}
		\end{figure}
		As shown in Fig.~\ref{fi:symbiotic_radio}, we propose a single-user (UE) single-tag (TG) symbiotic radio network where the RF signal generated by the single-antenna Access Point (AP) is shared by two coexisting systems. In the primary AP-UE downlink system, the AP transmits to the single-antenna user. In the secondary AP-TG-UE backscatter system, the AP acts as the carrier emitter, the user serves as the backscatter reader, and the single-antenna tag modulates its information over the reradiated RF signal by varying the reflection coefficient. Denote the AP-UE direct channel as $h_{\mathrm{D}}$, the AP-TG forward channel as $h_{\mathrm{F}}$, and the TG-UE backward channel as $h_{\mathrm{B}}$. We consider the quasi-static block fading model and assume the CSI of the direct channel and the cascaded forward-backward channel $h_{\mathrm{C}} \triangleq h_{\mathrm{B}} h_{\mathrm{F}}$ are known at the AP.\footnote{Due to the lack of RF chains at the passive tag, accurate and efficient CSI acquisition at the AP can be challenging. One possible approach is that the AP sends known pilots, the tag responds in a pre-defined manner, and the user performs least-square estimation then feeds back to the AP \cite{Bharadia2015,Yang2015b,Guo2019e}.} It is assumed that the primary symbol $s$ follows standard CSCG distribution $\mathcal{CN}(0,1)$ and the secondary symbol $c$ employs $M$-PSK modulation by \eqref{eq:backscatter_modulation}. Due to the practical constraints on switching speed and synchronization gap, the passive tag typically transmits at a much lower data rate than the AP. Hence, we assume the secondary symbol period is $N \gg 1 \in \mathbb{Z}_{++}$ times the primary symbol period and focus on the interval of one particular $c$. At (primary) symbol block $n \in \mathcal{N} \triangleq \{1,\ldots,N\}$, the user simultaneously captures the signal from both primary and secondary links as\footnote{We assume the time difference of arrival from the AP-UE path and the AP-TG-UE path are negligible compared to the symbol period \cite{Guo2019b,Liang2020,Long2020a}.}
		\begin{equation}
			y[n] = \sqrt{P} h_{\mathrm{D}} s[n] + \sqrt{\alpha P} h_{\mathrm{C}} c s[n] + w[n],
		\end{equation}
		where $P$ is the average transmit power at the AP and $w \sim \mathcal{CN}(0,\sigma^2)$ is the additive white Gaussian noise. We also define $\boldsymbol{y} \triangleq \bigl[y[1], \ldots, y[N]\bigr]^T$.

		\begin{remark}
			The symbiotic radio network can be regarded as as a special case of Multiple Access Channel (MAC) because the AP and the tag simultaneously transmit to the user. It is known that Superposition Coding-Successive Interference Cancellation (SC-SIC) with different decoding orders can achieve different vertices of the MAC capacity region \cite{Goldsmith2005}. Therefore, most relevant papers proposed the user to first decode the primary message (by treating the tag interference as noise), cancel out its contribution from the received signal, then decode the secondary message. Since the direct channel is typically much stronger than the cascaded channel \cite{Ozdogan2020}, the primary decoding is expected to enjoy a high Signal-to-Interference-and-Noise Ratio (SINR) and the secondary decoding is ideally interference-free.
		\end{remark}

		\begin{remark}
			The main difference between symbiotic radio and conventional MAC is that the primary message also reaches the user from the backscatter link. This characteristic inspires one to first decode the tag message, then model its contribution within the equivalent channel during primary decoding (i.e., unify backscatter decoding and channel training), instead of performing SIC. In such case, the reflection pattern not only embeds the tag message but also adjusts the legacy channel in a controllable manner. Therefore, for a fixed fading block, the primary transmission is able to achieve the ergodic capacity with artificial channel variation created by the backscatter modulation. [Channel over channel, randomness over randomness]
		\end{remark}

		\begin{subsection}{Backscatter Detection}
			To investigate how backscatter modulation potentially benefits the primary transmission, we first decode the tag symbol $c$ in presence of the interference from the primary message $\boldsymbol{s}$. In such case, the detection indeed coincides with that of Ambient Backscatter Communications (AmBC) where the signaling from the ambient source is unknown, and the received signal per symbol block follows the CSCG distribution of $y_m[n] \sim \mathcal{CN}(0,\sigma_m^2)$, where
			\begin{equation}
				\sigma_m^2 \triangleq \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_m \rvert^2 P + \sigma^2
			\end{equation}
			can be estimated at the user. For the ease of exposition, we sort $\{\sigma_m^2\}$ in a descending order by bijective mapping $f \colon m \mapsto i$,\footnote{Note that the mapping is not unique and the detection fails when two different constellation points yield the same energy level.} and formulate a sequence $\langle \sigma_i^2 \rangle$ where $\sigma_i^2 \ge \sigma_j^2$ for $i > j$, $i,j \in \mathcal{M}$. Denote $\mathcal{H}_i$ as the hypothesis that the tag transmits $c_i$. Following \cite{Qian2019}, the optimal Maximum-Likelihood (ML) detector boils down to the energy detector, and the likelihood ratio between hypotheses $\mathcal{H}_i$ and $\mathcal{H}_j$ is
			\begin{equation}
				\Lambda_{i, j}(\boldsymbol{y}) = \frac{f(\boldsymbol{y} \mid \mathcal{H}_i)}{f(\boldsymbol{y} \mid \mathcal{H}_j)} = \left( \frac{\sigma_j^2}{\sigma_i^2} \right)^N \exp \left( \frac{(\sigma_i^2 - \sigma_j^2) z}{\sigma_i^2 \sigma_j^2} \right),
			\end{equation}
			where $f(\boldsymbol{y} \mid \mathcal{H}_i)$, $f(\boldsymbol{y} \mid \mathcal{H}_j)$ denote respectively the conditional probability density function of receiving $\boldsymbol{y}$ under hypothesis $\mathcal{H}_i$ and $\mathcal{H}_j$, and $z \triangleq \lVert y \rVert^2$ is the received signal energy over $N$ symbol blocks. The corresponding decision rule is
			\begin{equation}
				\Lambda_{i, j}(\boldsymbol{y}) \underset{H_j}{\overset{H_i}{\gtrless}} 1 \iff z \underset{H_j}{\overset{H_i}{\gtrless}} T_{i, j},
			\end{equation}
			where the optimal detection threshold is
			\begin{equation}
				T_{i, j} \triangleq N \frac{\sigma_i^2 \sigma_j^2}{\sigma_i^2 - \sigma_j^2} \log \frac{\sigma_i^2}{\sigma_j^2}.
			\end{equation}
			On top of this, the decision region of hypothesis $\mathcal{H}_i$ can be expressed as
			\begin{equation}
				\mathcal{R}_i \triangleq [T_{i-1, i}, T_{i, i+1}),
			\end{equation}
			where we define $T_{0, 1} \triangleq 0$ and $T_{M, M+1} \triangleq \infty$. On the other hand, the transition probability matrix is
			\begin{equation}
				\boldsymbol{P} =
				\begin{bmatrix}
					p_{1, 1} & \ldots & p_{1, M} \\
					\vdots & \ddots & \vdots \\
					p_{M, 1} & \ldots & p_{M, M}
				\end{bmatrix},
			\end{equation}
			where $p_{i, j}$ denotes the transition probability from channel input state $i$ to output state $j$. It can be derived as
			\begin{equation}
				p_{i, j} = p(z \in \mathcal{R}_j \mid \mathcal{H}_i) = \int_{\mathcal{R}_j} f(z \mid \mathcal{H}_i) \dd z
				\label{eq:transition_probability}
			\end{equation}
			where $f(z \mid \mathcal{H}_i)$ is the conditional probability density function of receiving $z$ under hypothesis $\mathcal{H}_i$. Since $z$ follows chi-squared distribution with $2N$ degrees of freedom, it holds that
			\begin{equation}
				f(z \mid \mathcal{H}_i) = \frac{z^{N-1} e^{-z/\sigma_i^2}}{\sigma_i^{2N} \Gamma(N)}
				\label{eq:conditional_pdf}
			\end{equation}
			where $\Gamma(\cdot)$ is the gamma function. Therefore, the transition matrix $\boldsymbol{P}$ can be calculated by substituting \eqref{eq:conditional_pdf} into \eqref{eq:transition_probability}, and the optimal input distribution can be obtained by the Blahut-Arimoto algorithm \cite{Arimoto1972,Blahut1972}.
		\end{subsection}

		\begin{subsection}{Legacy Transmission}
			Once the tag message is successfully recovered, the user combines the backscattered symbol with the cascaded channel to eliminate the uncertainty of the AP-TG-UE path and detects the legacy information. The received signal at symbol block $n$ is essentially
			\begin{equation}
				y[n] = \sqrt{P} (h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c) s[n] + w[n] \triangleq \sqrt{P} h_{\mathrm{E}}(c) s + w[n],
			\end{equation}
			which is reminiscent of IRS-aided point-to-point transmission with an equivalent channel of
			\begin{equation}
				h_{\mathrm{E}}(c) \triangleq h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c.
			\end{equation}
			For primary transmission, backscatter modulation creates an artificial fast fading within each fading block, and the equivalent CSI is known at the receiver once the backscattered symbol is successfully decoded. Therefore, the ergodic capacity of primary transmission within each symbol block is \cite{Tse2005}
			\begin{equation}
				R_s = \mathbb{E}_c \bigl[ \log_2 ( 1 + \lvert h_{\mathrm{E}}(c) \rvert^2 ) \bigr].
			\end{equation}
			It can be observed that the input distribution of $c$ determines the capacity of both primary and secondary links.
		\end{subsection}
		\label{se:system_model}
	\end{section}

	\begin{section}{Tag Input Distribution}
		To achieve a flexible tradeoff between the backscatter and legacy links, we aims to optimize the probability mass function of the tag input distribution under $M$-PSK modulation. Denote the probability that the tag symbol $c$ takes $c_m$ as $p_m$ and the corresponding probability mass function as $\boldsymbol{p} = [p_1,\ldots,p_M]^T \in \mathbb{R}_+^{M \times 1}$. One possible problem formulation is to maximize the weighted sum of the primary and secondary rates subject to the sum-probability constraint
		\begin{maxi!}
			{\scriptstyle{\boldsymbol{p}}}{\rho R_s + (1 - \rho) R_c}{}{}
			\addConstraint{\sum_{m \in \mathcal{M}} p_m}{=1,}{}
		\end{maxi!}
		where $\rho \in [0, 1]$ is the weight factor to control the backscatter-legacy tradeoff.
	\end{section}

	\bibliographystyle{IEEEtran}
	\bibliography{IEEEabrv,library.bib}
\end{document}
