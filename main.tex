\documentclass[journal]{IEEEtran}

\usepackage{adjustbox}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{array}
\usepackage{circuitikz}
\usepackage{cite}
\usepackage{colortbl}
\usepackage{environ}
\usepackage{grffile}
\usepackage{hyperref}
\usepackage{import}
\usepackage{mathtools}
\usepackage{microtype}
\usepackage{multirow}
\usepackage{pgffor}
\usepackage{pgfplots}
\usepackage{physics}
\usepackage{siunitx}
\usepackage{stfloats}
\usepackage{tikz}
\usepackage{url}
\usepackage{xcolor}
\usepackage[T1]{fontenc}
\usepackage[caption=false,font=footnotesize,subrefformat=parens,labelformat=parens]{subfig}
\usepackage[short]{optidef}
% \usepackage[subtle]{savetrees}

\listfiles
\interdisplaylinepenalty=2500
\pgfplotsset{compat=newest}
\usepgfplotslibrary{patchplots}
\newtheorem{proposition}{Proposition}
\newtheorem{remark}{Remark}
\newtheorem{theorem}{Theorem}
\DeclareSIUnit{\belm}{Bm}
\DeclareSIUnit{\dBm}{\deci\belm}
\DeclareSIUnit{\beli}{Bi}
\DeclareSIUnit{\dBi}{\deci\beli}
\ctikzset{american}
\usetikzlibrary{arrows,calc,matrix,patterns,positioning}

\DeclarePairedDelimiterX{\infdivx}[2]{(}{)}{%
	#1\;\delimsize\|\;#2%
}
\newcommand{\infdiv}{D\infdivx}

\makeatletter
\tikzset{
	block/.style={draw,rectangle,align=center},
    from/.style args={#1 to #2}{
        above right={0cm of #1},
        /utils/exec=\pgfpointdiff
            {\tikz@scan@one@point\pgfutil@firstofone(#1)\relax}
            {\tikz@scan@one@point\pgfutil@firstofone(#2)\relax},
        minimum width/.expanded=\the\pgf@x,
        minimum height/.expanded=\the\pgf@y
	}
}
\makeatother

\algrenewcommand{\algorithmicwhile}{\textbf{While}}
\algrenewcommand{\algorithmicif}{\textbf{If}}
\algrenewcommand{\algorithmicthen}{\textbf{Then}}
\algrenewcommand{\algorithmicelse}{\textbf{Else}}
\algrenewcommand{\algorithmicend}{\textbf{End}}
\algrenewcommand{\algorithmicrepeat}{\textbf{Repeat}}
\algrenewcommand{\algorithmicuntil}{\textbf{Until}}


\begin{document}
	\title{Backscatter Modulation Design for Symbiotic Radio Networks}
	\maketitle

	\begin{section}{Backscatter Model}
		\begin{subsection}{Backscatter Principles}
			\begin{figure}[!t]
				\centering
				\subfloat[Block diagram of a passive tag]{
					\resizebox{0.6\columnwidth}{!}{
						\begin{circuitikz}[transform shape]
							\coordinate (O) at (0,0);
							\node[block,from={O to $(O) + (6.375,3.25)$}](T){};
							\draw (0,1.75)
								to[short] ++(-1,0)
								to[short] ++(0,0.75) node[bareantenna](A){Ant};
							\draw (0,1.75)
								to[short,-*] ++(0.25,0) coordinate(J);
							\draw (J)
								to[short] ++(0,1)
								to[short] ++(0.5,0) coordinate(J1);
							\node[block,from={$(J1) + (0,-0.25)$ to $(J1) + (2.5,0.25)$}](R){Rectifier};
							\draw (J)
								to[short] ++(0.5,0) coordinate(J2);
							\node[block,from={$(J2) + (0,-0.25)$ to $(J2) + (2.5,0.25)$}](D){Demodulator};
							\draw (J)
								to[short] ++(0,-1)
								to[short] ++(0.5,0) coordinate(J3)
								to [vR,mirror,invert,/tikz/circuitikz/bipoles/length=1cm] ++(1.75,0) node[ground,rotate=90]{};
							\node[block,from={$(J3) + (0,-0.25)$ to $(J3) + (2.5,0.25)$},draw=none](M){};
							\draw ($(J3) + (0,-0.25)$) rectangle ($(J3) + (2.5,0.25)$);
							\draw ($(J3) + (1.25,-0.5)$) node[]{Modulator};
							\draw[-{Latex[length=2mm]}] (R.east) -- ++(0.75,0);
							\draw[-{Latex[length=2mm]}] (D.east) -- ++(0.75,0);
							\draw[{Latex[length=2mm]}-] (M.east) -- ++(0.75,0);
							\node[block,from={$(R.east) + (0.75,-0.25)$ to $(R.east) + (2.875,0.25)$}](P){Power buffer};
							\node[block,from={$(M.east) + (0.75,-0.25)$ to $(D.east) + (2.875,0.25)$}](S){Digital\\section};
							\draw[dashed,-{Latex[length=2mm]}] (P.south) to (S.north);
							\coordinate (F1) at ($(P.south)!0.5!(S.north)$);
							\coordinate (F2) at ($(D.east)!0.5!(S.west)$);
							\coordinate (F3) at ($(D.south)!0.5!(M.north)$);
							\draw[dashed] (F1) to (F1-|D.north);
							\draw[dashed,-{Latex[length=2mm]}] (F1-|D.north) to (D.north);
							\draw[dashed] (F1-|F2) to (F2|-F3) to (M|-F3);
							\draw[dashed,-{Latex[length=2mm]}] (M|-F3) to (M.north);
						\end{circuitikz}
					}
					\label{fi:block_diagram_of_a_passive_tag}
				}
				\subfloat[Backscatter modualtion]{
					\resizebox{0.35\columnwidth}{!}{
						\begin{circuitikz}[transform shape]
							\draw (0,0) node[bareantenna](bareantenna){};
							\draw (bareantenna.west) ++(-1.5,0) node[waves](WI){};
							\draw (WI.north east) ++(0.25,0) node[font=\Large]{$\vec{E}_{\mathrm{I}}$};
							\draw (WI.south east) ++(0.25,0) node[font=\Large]{$\vec{H}_{\mathrm{I}}$};
							\draw (bareantenna.east) ++(0.875,0) node[waves](WR){};
							\draw (WR.north east) ++(0.25,0) node[font=\Large]{$\vec{E}_m$};
							\draw (WR.south east) ++(0.25,0) node[font=\Large]{$\vec{H}_m$};
							\draw (bareantenna)
								to [R=$Z_{\mathrm{A}}$,font=\Large,/tikz/circuitikz/bipoles/length=1cm] ++(0,-2)
								to [R=$Z_m$,font=\Large,/tikz/circuitikz/bipoles/length=1cm] ++(2,0) node[ground]{};
						\end{circuitikz}
					}
					\label{fi:backscatter_modualtion}
				}
				\caption{For a passive tag, the rectifier and demodulator rely on the incident electromagnetic wave for energy harvesting and source decoding, while the load-switcher adjusts the reradiated signal for backscatter modulation.}
				\label{fi:tag}
			\end{figure}
			A bistatic backscatter system consists of an excitation source, multiple (semi-)passive tags, and a backscatter reader. When illuminated, the tags simultaneously harvest energy, backscatter message, and demodulate the source signal if necessary. Fig.~\subref*{fi:block_diagram_of_a_passive_tag} shows a typical passive with a scattering antenna, an energy harvester, an integrated receiver\footnote{For example, \cite{Kim2021a} prototyped a compact-size pulse position demodulator based on an envelope detector, which brings great potential to coordination, synchronization, and reflection pattern control.}, a load-switching modulator, and on-chip components (e.g., micro-controller, memory, and sensors). A portion of the impinging signal is absorbed by the tag while the remaining is backscattered to the space. According to Green's decomposition \cite{Hansen1989}, the backscattered signal can be decomposed into the \emph{structural mode} component and the \emph{antenna mode} component. The former is fixed and depends on the antenna geometry and material properties\footnote{The structural mode component can be regarded as part of the environment multipath and modeled by channel estimation \cite{Boyer2014}.}, while the latter is adjustable and depends on the mismatch of the antenna and load impedance. Fig.~\subref*{fi:backscatter_modualtion} illustrates a simplified circuit and backscatter model at tag state $m$. The corresponding reflection coefficient is defined as\footnote{We assume the linear backscatter model where the reflection coefficient is irrelevant to the incident electromagnetic field at the tag \cite{Dobkin2012}.}
			\begin{equation}
				\Gamma_m = \frac{Z_m - Z_{\mathrm{A}}^*}{Z_m + Z_{\mathrm{A}}},
				\label{eq:reflection_coefficient}
			\end{equation}
			where $Z_m$ is the load impedance at state $m$ and $Z_{\mathrm{A}}$ is the antenna input impedance.
		\end{subsection}

		\begin{subsection}{Backscatter Modulation}
			Backscatter modulation is achieved by switching the tag load impedance between different states. For an $M$-ary Quadrature Amplitude Modulation (QAM) at state $m \in \mathcal{M} \triangleq \{1,\ldots,M\}$, the reflection coefficient $\Gamma_m$ maps to the signal constellation point $c_m$ as \cite{Thomas2012a}
			\begin{equation}
				\Gamma_m = \alpha \frac{c_m}{\max_{m'} \lvert c_{m'} \rvert},
				\label{eq:backscatter_modulation}
			\end{equation}
			where $\alpha \in [0,1]$ is the reflection efficiency at a given direction. For simplicity, we consider an $M$-ary Phase Shift Keying (PSK) with zero-offset (TODO), where the $m$-th constellation point is
			\begin{equation}
				c_m = \exp \left(j \frac{2 \pi m}{M}\right).
				\label{eq:mpsk}
			\end{equation}
			\begin{remark}
				For passive tags, the reflection efficiency $\alpha$ controls the tradeoff between the harvestable power and backscatter strength: $\alpha = 0$ corresponds to maximum power transfer to the tag, while $\alpha = 1$ with $M$-PSK corresponds to ideal Intelligent Reflecting Surface (IRS) with $M$ discrete states.
			\end{remark}
		\end{subsection}
	\end{section}

	\begin{section}{The Multi-Tag Case}
		\begin{subsection}{System Model}
			\begin{figure}[!t]
				\centering
				\def\svgwidth{0.9\columnwidth}
				\import{assets/}{symbiotic_radio.eps_tex}
				\caption{A single-user multi-tag symbiotic radio system.}
				\label{fi:symbiotic_radio}
			\end{figure}
			As shown in Fig.~\ref{fi:symbiotic_radio}, we propose a single-user (UE) multi-tag (TG) symbiotic radio network where the RF signal generated by the $Q$-antenna Access Point (AP) is shared by two coexisting systems. In the primary downlink system, the AP transmits information to the single-antenna user. In the secondary backscatter system, the AP acts as the carrier emitter, the $K$ nearby single-antenna tags modulate their information over the reradiated RF signals, and the user serves as the multi-tag backscatter reader. Denote the AP-UE direct channel as $\boldsymbol{h}_{\mathrm{D}}^H \in \mathbb{C}^{1 \times Q}$, the AP-TG $k \in \mathcal{K} \triangleq \{1,\ldots,K\}$ forward channel as $\boldsymbol{h}_{\mathrm{F},k}^H \in \mathbb{C}^{1 \times Q}$, the TG $k$-UE backward channel as $h_{\mathrm{B},k}$, and the cascaded forward-backward channel of tag $k$ as $\boldsymbol{h}_{\mathrm{C},k}^H \triangleq h_{\mathrm{B},k} \boldsymbol{h}_{\mathrm{F},k}^H \in \mathbb{C}^{1 \times Q}$. For simplicity, we consider a quasi-static block fading model where the channel coefficients remain constant within each coherence interval and vary independently over different coherence intervals, and assume the coherence interval $T$ is much longer than the backscatter symbol period $T_c$ and primary symbol period $T_s$. We also assume the direct channel and all cascaded channels can be successfully estimated and fed back to the AP.\footnote{Due to the lack of RF chains at the passive tag, accurate and efficient Channel State Information at the Transmitter (CSIT) acquisition can be challenging. One possible approach is that the AP sends pre-defined pilots, the tags respond in well-designed manners, and the user performs least-square estimation with feedbacks \cite{Bharadia2015,Yang2015b,Guo2019e}.} Since the tags need to physically switch the loads for backscatter modulation, they communicate at a much longer symbol period (and lower rates) than the primary system. As such, we assume the transitions of all tags are perfectly synchronized, and the backscatter symbol period satisfies $T_c = N T_s$ where $N \gg 1$ is a positive integer.

			Without loss of generality, we focus on the transmissions and detections during one particular backscatter symbol period. To provide a preliminary insight, we assume the primary symbol $s[n]$ at block $n \in \mathcal{N} \triangleq \{1,\ldots,N\}$ is in standard CSCG distribution, and the backscatter symbol $c_k$ of tag $k$ employs $M$-PSK modulation by \eqref{eq:mpsk}, $\forall k \in \mathcal{K}$. Thus, the signal received by the user at block $n$ can be expressed as\footnote{We omit the signal reflected by two or more times\cite{Wu2019} and assume the time difference of arrival from different paths are negligible\cite{Guo2019b}.}
			\begin{equation}
				y[n] = \left(\boldsymbol{h}_{\mathrm{D}}^H + \sum_{k \in \mathcal{K}} \sqrt{\alpha_k} \boldsymbol{h}_{\mathrm{C},k}^H c_k\right) \boldsymbol{w} s[n] + w[n],
				\label{eq:received_signal}
			\end{equation}
			where $\boldsymbol{w} \in \mathbb{C}^{Q \times 1}$ is the active precoder satisfying $\lVert \boldsymbol{w} \rVert^2 \le P$, $P$ is the average transmit power constraint at the AP, and $w[n] \sim \mathcal{CN}(0,\sigma^2)$ is the equivalent Additive White Gaussian Noise (AWGN) at block $n$. Besides, we stack the backscatter symbol of $K$ tags as $\boldsymbol{c} \triangleq [c_1,\ldots,c_K]^T \in \mathbb{C}^{K \times 1}$, the received signal over $N$ blocks as $\boldsymbol{y} \triangleq [y[1],\ldots,y[N]]^T \in \mathbb{C}^{N \times 1}$, and define the equivalent channel for primary transmission as
			\begin{equation}
				h_{\mathrm{E}}^H(\boldsymbol{c}) \triangleq \boldsymbol{h}_{\mathrm{D}}^H + \sum_{k \in \mathcal{K}} \sqrt{\alpha_k} \boldsymbol{h}_{\mathrm{C},k}^H c_k.
				\label{eq:equivalent_channel}
			\end{equation}

			\begin{remark}
				The proposed symbiotic radio system includes a multiplicative Multiple Access Channel (MAC) where the AP and the tags simultaneously transmit to the user. It inspired [TODO] to perform Successive Interference Cancellation (SIC) that first non-coherently detects the primary message under backscatter uncertainty, then cancels its contribution and decodes the tag messages. This scheme requires non-coherent coding at the AP and $K$ re-encoding, precoding, and subtraction operations at the user. However, different from the conventional MAC with Superposition Coding (SC), the symbiotic radio system involves Multiplication Coding (MC) that combines the primary and secondary messages by multiplication. Hence, novel multi-stream detection techniques should be tailored to symbiotic radio systems to accommodate the massive connectivity of tags and the multiplicative combination of links.
			\end{remark}
		\end{subsection}

		\begin{subsection}{Signal Detection}
			To reveal the impact of backscatter modulation on the primary transmission, we extend the non-coherent AmBC detection scheme \cite{Qian2019} to the multi-tag case and propose a low-complexity energy detection that decodes the backscatter symbols under primary source uncertainty. It requires no dedicated receivers or non-coherent codes at the AP, and can be readily implemented over legacy downlink systems.

			\begin{remark}
				One key property of symbiotic radio is the primary message propagates to the user from a known channel and multiple multiplicative channels with uncertainty introduced by backscatter modulation. If the backscatter symbols can be successfully decoded first, they can be modeled within the equivalent channel \eqref{eq:equivalent_channel} as channel training, instead of being removed by SIC. In other words, the reflection coefficient simultaneously encodes the tag message and influences the equivalent channel of primary link.
			\end{remark}

			how backscatter modulation potentially benefits the primary transmission, we first decode the tag symbol $c$ in presence of the interference from the primary message $\boldsymbol{s}$. In such case, the detection indeed coincides with that of Ambient Backscatter Communications (AmBC) where the signaling from the ambient source is unknown, and the received signal per symbol block follows the CSCG distribution of $y_m[n] \sim \mathcal{CN}(0,\sigma_m^2)$, where
			\begin{equation}
				\sigma_m^2 \triangleq \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_m \rvert^2 P + \sigma^2
				\label{eq:typical_energy}
			\end{equation}
			denotes the typical received signal energy over $N$ symbol blocks when the tag is at state $m$, which can be estimated at the user. For the ease of exposition, we sort $\{\sigma_m^2\}$ in a ascending order by bijective mapping $f \colon m \mapsto i$\footnote{Note that the mapping is not unique and the detection fails when two different constellation points yield the same energy level.} and let $\sigma_i^2 \le \sigma_j^2$ for $i < j$, $i,j \in \mathcal{M}$. Denote $\mathcal{H}_i$ as the hypothesis that the tag transmits $c_i$. Following \cite{Qian2019}, the optimal Maximum-Likelihood (ML) detector boils down to the energy detector, and the likelihood ratio between hypotheses $\mathcal{H}_i$ and $\mathcal{H}_j$ is
			\begin{equation}
				\Lambda_{i, j}(\boldsymbol{y}) = \frac{f(\boldsymbol{y} \mid \mathcal{H}_i)}{f(\boldsymbol{y} \mid \mathcal{H}_j)} = \left( \frac{\sigma_j^2}{\sigma_i^2} \right)^N \exp \left( \frac{(\sigma_i^2 - \sigma_j^2) z}{\sigma_i^2 \sigma_j^2} \right),
			\end{equation}
			where $f(\boldsymbol{y} \mid \mathcal{H}_i)$, $f(\boldsymbol{y} \mid \mathcal{H}_j)$ denote respectively the conditional probability density function of receiving $\boldsymbol{y}$ under hypothesis $\mathcal{H}_i$ and $\mathcal{H}_j$, and $z \triangleq \lVert y \rVert^2$ is the received signal energy over $N$ symbol blocks. The corresponding decision rule is
			\begin{equation}
				\Lambda_{i, j}(\boldsymbol{y}) \underset{H_j}{\overset{H_i}{\lessgtr}} 1 \iff z \underset{H_j}{\overset{H_i}{\lessgtr}} T_{i, j},
			\end{equation}
			where the optimal detection threshold is
			\begin{equation}
				T_{i, j} \triangleq N \frac{\sigma_i^2 \sigma_j^2}{\sigma_i^2 - \sigma_j^2} \log \frac{\sigma_i^2}{\sigma_j^2},
				\label{eq:detection_threshold}
			\end{equation}
			and the decision region of hypothesis $\mathcal{H}_i$ can be expressed as
			\begin{equation}
				\mathcal{R}_i \triangleq [T_{i-1, i}, T_{i, i+1}),
				\label{eq:decision_region}
			\end{equation}
			with $T_{0, 1} \triangleq 0$ and $T_{M, M+1} \triangleq \infty$. On top of this, we define the forward transition probability matrix $\boldsymbol{P} \in \mathbb{R}_{+}^{M \times M}$ as
			\begin{equation}
				\boldsymbol{P} \triangleq
				\begin{bmatrix}
					p_{1, 1} & \ldots & p_{1, M} \\
					\vdots & \ddots & \vdots \\
					p_{M, 1} & \ldots & p_{M, M}
				\end{bmatrix},
			\end{equation}
			where $p_{i, j}$ denotes the transition probability from channel input state $i$ to output state $j$. It can be derived as
			\begin{equation}
				p_{i, j} = p(z \in \mathcal{R}_j \mid \mathcal{H}_i) = \int_{\mathcal{R}_j} f(z \mid \mathcal{H}_i) \dd z,
				\label{eq:transition_probability}
			\end{equation}
			where $f(z \mid \mathcal{H}_i)$ is the conditional probability density function of receiving $z$ under hypothesis $\mathcal{H}_i$. Since $z$ follows chi-squared distribution with $2N$ degrees of freedom, it holds that
			\begin{equation}
				f(z \mid \mathcal{H}_i) = \frac{z^{N-1} e^{-z/\sigma_i^2}}{\sigma_i^{2N} \Gamma(N)},
				\label{eq:conditional_pdf}
			\end{equation}
			where $\Gamma(\cdot)$ is the gamma function. To summarize, with the CSI of the direct and cascaded links, the typical energy of the received signal can be estimated by \eqref{eq:typical_energy}, the energy detection threshold can be computed by \eqref{eq:detection_threshold}, the decision region can be retrieved by \eqref{eq:decision_region}, and the forward transition matrix $\boldsymbol{P}$ can be calculated by substituting \eqref{eq:conditional_pdf} into \eqref{eq:transition_probability}.

			We then investigate the achievable rate of the backscatter link. Denote the tag input probability mass function as $\boldsymbol{r} = [r_1,\ldots,r_M]^T \in \mathbb{R}_+^{M \times 1}$ where $r_m$ is the probability to transmit symbol $c_m$ [strictly positive?]. For a given input distribution $\boldsymbol{r}$ and forward transition matrix $\boldsymbol{P}$, the achievable backscatter rate can be written as
			\begin{equation}
				R_c = \max_{\boldsymbol{Q} \ge 0} \sum_{i \in \mathcal{M}} \sum_{j \in \mathcal{M}} r_i p_{i, j} \log_2 \frac{q_{j, i}}{r_i} \ [\si{bpcu}],
				\label{eq:secondary_rate}
			\end{equation}
			where $\boldsymbol{Q} \in \mathbb{R}_{+}^{M \times M}$ is the backward transition probability matrix
			\begin{equation}
				\boldsymbol{Q} \triangleq
				\begin{bmatrix}
					q_{1, 1} & \ldots & q_{1, M} \\
					\vdots & \ddots & \vdots \\
					q_{M, 1} & \ldots & q_{M, M}
				\end{bmatrix},
			\end{equation}
			and $q_{j, i}$ denotes the transition probability from channel output state $j$ to input state $i$.
		\end{subsection}
	\end{section}

	\begin{section}{The Single-tag Case}
		% \begin{figure}[!t]
		% 	\centering
		% 	\def\svgwidth{0.9\columnwidth}
		% 	\import{assets/}{symbiotic_radio.pdf_tex}
		% 	\caption{A single-user single-tag symbiotic radio system.}
		% 	\label{fi:symbiotic_radio}
		% \end{figure}
		As shown in Fig.~NULL, we propose a single-user (UE) single-tag (TG) symbiotic radio network where the RF signal generated by the single-antenna Access Point (AP) is shared by two coexisting systems. In the primary AP-UE downlink system, the AP transmits to the single-antenna user. In the secondary AP-TG-UE backscatter system, the AP acts as the carrier emitter, the user serves as the backscatter reader, and the single-antenna tag modulates its information over the reradiated RF signal by varying the reflection coefficient. Denote the AP-UE direct channel as $h_{\mathrm{D}}$, the AP-TG forward channel as $h_{\mathrm{F}}$, and the TG-UE backward channel as $h_{\mathrm{B}}$. We consider the quasi-static block fading model and assume the CSI of the direct channel and the cascaded forward-backward channel $h_{\mathrm{C}} \triangleq h_{\mathrm{B}} h_{\mathrm{F}}$ are known at the AP.\footnote{Due to the lack of RF chains at the passive tag, accurate and efficient CSI acquisition at the AP can be challenging. One possible approach is that the AP sends known pilots, the tag responds in a pre-defined manner, and the user performs least-square estimation then feeds back to the AP \cite{Bharadia2015,Yang2015b,Guo2019e}.} It is assumed that the primary symbol $s$ follows standard CSCG distribution $\mathcal{CN}(0,1)$ and the secondary symbol $c$ employs $M$-PSK modulation by \eqref{eq:backscatter_modulation}. Due to the practical constraints on switching speed and synchronization gap, the passive tag typically transmits at a much lower data rate than the AP. Hence, we assume the secondary symbol period is $N \gg 1 \in \mathbb{Z}_{++}$ times the primary symbol period and focus on the interval of one particular $c$. At (primary) symbol block $n \in \mathcal{N} \triangleq \{1,\ldots,N\}$, the user simultaneously captures the signal from both primary and secondary links as\footnote{We assume the time difference of arrival from the AP-UE path and the AP-TG-UE path are negligible compared to the symbol period \cite{Guo2019b,Liang2020,Long2020a}.}
		\begin{equation}
			y[n] = \sqrt{P} h_{\mathrm{D}} s[n] + \sqrt{\alpha P} h_{\mathrm{C}} c s[n] + w[n],
		\end{equation}
		where $P$ is the average transmit power at the AP and $w \sim \mathcal{CN}(0,\sigma^2)$ is the additive white Gaussian noise. We also define $\boldsymbol{y} \triangleq \bigl[y[1],\ldots,y[N]\bigr]^T$.

		\begin{remark}
			The symbiotic radio network can be regarded as a special case of Multiple Access Channel (MAC) because the AP and the tag simultaneously transmit to the user. It is known that Superposition Coding-Successive Interference Cancellation (SC-SIC) with different decoding orders can achieve different vertices of the MAC capacity region \cite{Goldsmith2005}. Therefore, most relevant papers proposed the user to first decode the primary message (by treating the tag interference as noise), cancel out its contribution from the received signal, then decode the secondary message. Since the direct channel is typically much stronger than the cascaded channel \cite{Ozdogan2020}, the primary decoding is expected to enjoy a high Signal-to-Interference-and-Noise Ratio (SINR) and the secondary decoding is ideally interference-free.
		\end{remark}

		\begin{remark}
			The main difference between symbiotic radio and conventional MAC is that the primary message also reaches the user from the backscatter link. This characteristic inspires one to first decode the tag message, then model its contribution within the equivalent channel during primary decoding (i.e., unify backscatter decoding and channel training), instead of performing SIC. In such case, the reflection pattern not only embeds the tag message but also adjusts the legacy channel in a controllable manner. Therefore, for a fixed fading block, the primary transmission is able to achieve the ergodic capacity with artificial channel variation created by the backscatter modulation. [Channel over channel, randomness over randomness]
		\end{remark}

		\begin{subsection}{Backscatter Transmission}
			To investigate how backscatter modulation potentially benefits the primary transmission, we first decode the tag symbol $c$ in presence of the interference from the primary message $\boldsymbol{s}$. In such case, the detection indeed coincides with that of Ambient Backscatter Communications (AmBC) where the signaling from the ambient source is unknown, and the received signal per symbol block follows the CSCG distribution of $y_m[n] \sim \mathcal{CN}(0,\sigma_m^2)$, where
			\begin{equation}
				\sigma_m^2 \triangleq \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_m \rvert^2 P + \sigma^2
				\label{eq:typical_energy}
			\end{equation}
			denotes the typical received signal energy over $N$ symbol blocks when the tag is at state $m$, which can be estimated at the user. For the ease of exposition, we sort $\{\sigma_m^2\}$ in a ascending order by bijective mapping $f \colon m \mapsto i$\footnote{Note that the mapping is not unique and the detection fails when two different constellation points yield the same energy level.} and let $\sigma_i^2 \le \sigma_j^2$ for $i < j$, $i,j \in \mathcal{M}$. Denote $\mathcal{H}_i$ as the hypothesis that the tag transmits $c_i$. Following \cite{Qian2019}, the optimal Maximum-Likelihood (ML) detector boils down to the energy detector, and the likelihood ratio between hypotheses $\mathcal{H}_i$ and $\mathcal{H}_j$ is
			\begin{equation}
				\Lambda_{i, j}(\boldsymbol{y}) = \frac{f(\boldsymbol{y} \mid \mathcal{H}_i)}{f(\boldsymbol{y} \mid \mathcal{H}_j)} = \left( \frac{\sigma_j^2}{\sigma_i^2} \right)^N \exp \left( \frac{(\sigma_i^2 - \sigma_j^2) z}{\sigma_i^2 \sigma_j^2} \right),
			\end{equation}
			where $f(\boldsymbol{y} \mid \mathcal{H}_i)$, $f(\boldsymbol{y} \mid \mathcal{H}_j)$ denote respectively the conditional probability density function of receiving $\boldsymbol{y}$ under hypothesis $\mathcal{H}_i$ and $\mathcal{H}_j$, and $z \triangleq \lVert y \rVert^2$ is the received signal energy over $N$ symbol blocks. The corresponding decision rule is
			\begin{equation}
				\Lambda_{i, j}(\boldsymbol{y}) \underset{H_j}{\overset{H_i}{\lessgtr}} 1 \iff z \underset{H_j}{\overset{H_i}{\lessgtr}} T_{i, j},
			\end{equation}
			where the optimal detection threshold is
			\begin{equation}
				T_{i, j} \triangleq N \frac{\sigma_i^2 \sigma_j^2}{\sigma_i^2 - \sigma_j^2} \log \frac{\sigma_i^2}{\sigma_j^2},
				\label{eq:detection_threshold}
			\end{equation}
			and the decision region of hypothesis $\mathcal{H}_i$ can be expressed as
			\begin{equation}
				\mathcal{R}_i \triangleq [T_{i-1, i}, T_{i, i+1}),
				\label{eq:decision_region}
			\end{equation}
			with $T_{0, 1} \triangleq 0$ and $T_{M, M+1} \triangleq \infty$. On top of this, we define the forward transition probability matrix $\boldsymbol{P} \in \mathbb{R}_{+}^{M \times M}$ as
			\begin{equation}
				\boldsymbol{P} \triangleq
				\begin{bmatrix}
					p_{1, 1} & \ldots & p_{1, M} \\
					\vdots & \ddots & \vdots \\
					p_{M, 1} & \ldots & p_{M, M}
				\end{bmatrix},
			\end{equation}
			where $p_{i, j}$ denotes the transition probability from channel input state $i$ to output state $j$. It can be derived as
			\begin{equation}
				p_{i, j} = p(z \in \mathcal{R}_j \mid \mathcal{H}_i) = \int_{\mathcal{R}_j} f(z \mid \mathcal{H}_i) \dd z,
				\label{eq:transition_probability}
			\end{equation}
			where $f(z \mid \mathcal{H}_i)$ is the conditional probability density function of receiving $z$ under hypothesis $\mathcal{H}_i$. Since $z$ follows chi-squared distribution with $2N$ degrees of freedom, it holds that
			\begin{equation}
				f(z \mid \mathcal{H}_i) = \frac{z^{N-1} e^{-z/\sigma_i^2}}{\sigma_i^{2N} \Gamma(N)},
				\label{eq:conditional_pdf}
			\end{equation}
			where $\Gamma(\cdot)$ is the gamma function. To summarize, with the CSI of the direct and cascaded links, the typical energy of the received signal can be estimated by \eqref{eq:typical_energy}, the energy detection threshold can be computed by \eqref{eq:detection_threshold}, the decision region can be retrieved by \eqref{eq:decision_region}, and the forward transition matrix $\boldsymbol{P}$ can be calculated by substituting \eqref{eq:conditional_pdf} into \eqref{eq:transition_probability}.

			We then investigate the achievable rate of the backscatter link. Denote the tag input probability mass function as $\boldsymbol{r} = [r_1,\ldots,r_M]^T \in \mathbb{R}_+^{M \times 1}$ where $r_m$ is the probability to transmit symbol $c_m$ [strictly positive?]. For a given input distribution $\boldsymbol{r}$ and forward transition matrix $\boldsymbol{P}$, the achievable backscatter rate can be written as
			\begin{equation}
				R_c = \max_{\boldsymbol{Q} \ge 0} \sum_{i \in \mathcal{M}} \sum_{j \in \mathcal{M}} r_i p_{i, j} \log_2 \frac{q_{j, i}}{r_i} \ [\si{bpcu}],
				\label{eq:secondary_rate}
			\end{equation}
			where $\boldsymbol{Q} \in \mathbb{R}_{+}^{M \times M}$ is the backward transition probability matrix
			\begin{equation}
				\boldsymbol{Q} \triangleq
				\begin{bmatrix}
					q_{1, 1} & \ldots & q_{1, M} \\
					\vdots & \ddots & \vdots \\
					q_{M, 1} & \ldots & q_{M, M}
				\end{bmatrix},
			\end{equation}
			and $q_{j, i}$ denotes the transition probability from channel output state $j$ to input state $i$.
		\end{subsection}

		\begin{subsection}{Legacy Transmission}
			Once the backscattered symbol is successfully recovered, it is combined with the cascaded channel to eliminate the uncertainty of the AP-TG-UE path and assist the legacy transmission. Therefore, the received signal at symbol block $n$ is essentially
			\begin{equation}
				y[n] = \sqrt{P} (h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c) s[n] + w[n] \triangleq \sqrt{P} h_{\mathrm{E}}(c) s + w[n],
			\end{equation}
			which is reminiscent of an IRS-aided point-to-point transmission with an equivalent channel of
			\begin{equation}
				h_{\mathrm{E}}(c) \triangleq h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c.
			\end{equation}
			For primary transmission, backscatter modulation creates an artificial fast fading within each fading block, and AP can obtain the equivalent CSI distribution for any given tag input probability mass function $\boldsymbol{r}$. Therefore, the ergodic capacity of primary transmission within each symbol block is \cite{Tse2005}
			\begin{align}
				R_s
				& = \mathbb{E}_c \bigl[ \log_2 (1 + \gamma \lvert h_{\mathrm{E}}(c) \rvert^2) \bigr] \nonumber \\
				& = \sum_{i \in \mathcal{M}} r_i \log_2 \bigl( 1 + \gamma \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_i \rvert^2 \bigr) \ [\si{bps/Hz}],
				\label{eq:primary_rate}
			\end{align}
			where $\gamma \triangleq P / \sigma^2$ is the average transmit Signal-to-Noise Ratio (SNR). It can be concluded that the achievable rate of both primary and secondary links depend on the tag input distribution.
		\end{subsection}
		\label{se:system_model}

		\begin{subsection}{Achievable rate region}
			To achieve a flexible tradeoff between the backscatter and legacy links, we aims to optimize the tag input probability mass function, under $M$-PSK modulation, to maximize the weighted sum of the primary and secondary rates subject to the sum-probability constraint
			\begin{maxi!}
				{\scriptstyle{\boldsymbol{r} \ge 0}}{\rho R_s + (1 - \rho) R_c}{\label{op:weighted_sum_rate}}{\label{ob:weighted_sum_rate}}
				\addConstraint{\sum_{i \in \mathcal{M}} r_i}{=1,}{\label{co:sum_probability}}
			\end{maxi!}
			where $\rho \in [0, 1]$ is the weight factor. By substituting \eqref{eq:secondary_rate} and \eqref{eq:primary_rate} into \eqref{ob:weighted_sum_rate}, the problem expands to
			\begin{maxi!}
				{\scriptstyle{\boldsymbol{r} \ge 0, \boldsymbol{Q} \ge 0}}{\rho \sum_{i \in \mathcal{M}} r_i \log_2 \bigl( 1 + \gamma \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_i \rvert^2 \bigr) \nonumber}{}{}
				\breakObjective{+ (1 - \rho) \sum_{i \in \mathcal{M}} \sum_{j \in \mathcal{M}} r_i p_{i, j} \log_2 \frac{q_{j, i}}{r_i}}{\label{ob:weighted_sum_rate_expanded}}
				\addConstraint{\sum_{i \in \mathcal{M}} r_i}{=1.}{}
			\end{maxi!}
			Similar to the Blahut-Arimoto algorithm \cite{Arimoto1972,Blahut1972}, we optimize $\boldsymbol{r}$ and $\boldsymbol{Q}$ alternatively to obtain the local optimal tag input distribution and the corresponding weighted sum-rate.
			\begin{theorem}
				For any valid tag input probability mass function $\boldsymbol{r}$ [$\boldsymbol{r} > \boldsymbol{0}$?], the optimal backward transition probability from channel output state $j$ to input state $i$ follows Bayes' Theorem as
				\begin{equation}
					q_{j, i}^{\star} = \frac{r_i p_{i, j}}{\sum_{i'} r_{i'} p_{i', j}}.
					\label{eq:backward_transition}
				\end{equation}
				\label{th:backward_transition}
			\end{theorem}
			\begin{proof}
				Please refer to Appendix~\ref{ap:backward_transition}.
			\end{proof}
			\begin{theorem}
				For any valid backward transition probability $\boldsymbol{Q}$ [$\boldsymbol{Q} \ge 0$?], the optimal tag input probability mass function is given by
				\begin{equation}
					r_i = \frac{\bigl( 1 + \gamma \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_i \rvert^2 \bigr)^{\rho / (1 - \rho)} \prod_{j \in \mathcal{M}} q_{j, i}^{p_{i, j}}}{\sum_{i' \in \mathcal{M}} \bigl( 1 + \gamma \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_{i'} \rvert^2 \bigr)^{\rho / (1 - \rho)} \prod_{j \in \mathcal{M}} q_{j, i'}^{p_{i', j}}}.
					\label{eq:input_distribution}
				\end{equation}
				\label{th:input_distribution}
			\end{theorem}
			\begin{proof}
				Please refer to Appendix~\ref{ap:input_distribution}.
			\end{proof}
			\begin{proposition}
				For any feasible initial point [constellation subset], the Algorithm is guaranteed to converge to the global optimal of problem \eqref{op:weighted_sum_rate} and achieve the maximum weighted-sum rate.
			\end{proposition}
			\begin{proof}
				The proof is similar to that in \cite[Chapter~9.3]{Yeung2008} and omitted here.
			\end{proof}
		\end{subsection}
	\end{section}

	\begin{section}{OFDM}
		Due to the constraint of energy detection, with single-antenna tags and reader, at most one AmBC tag can be decoded at a time and accurate detection requires repetition coding over multiple time/frequency blocks to mitigate the impact of primary symbols. Here we consider frequency-independent tag reflection and schedule one tag per OFDM symbol.

		At OFDM symbol $r$, tag $l$ modulates its own information over all $N$ subcarriers while the remaining tags may operate in the cooperative (quantized IRS) mode. Channel frequency response at subband $n$ and block $r$
		Received signal at OFDM symbol $r$ and subband $n$ is
		\begin{equation}
			y_n[r] = \sqrt{P} h_{\mathrm{E}}[r] s_n[r] + \sqrt{\alpha P} h_{\mathrm{C},l} c_l s_n[r] + w_n[r],
		\end{equation}
		where $h_{\mathrm{E}}[r] \triangleq \sum_{l' \ne l} h_{\mathrm{C},l'} c_{l'}^\star$ and $c_l$ is the symbol of tag $l$. Apparently $y_n[r] \sim \mathcal{CN}(0,\sigma_n^2[r])$ with $\sigma_n^2[r] \triangleq \lvert h_{\mathrm{E}}[r] + \sqrt{\alpha} h_{\mathrm{C},l} c_l \rvert^2 P + \sigma^2$. Define $\boldsymbol{y}[r] \triangleq [y_1[r],\ldots,y_N[r]]^T$ and we can do energy detection over $N$ subcarriers.
	\end{section}

	\begin{section}{Multi-Tag Case}
		In the $K$-tag scenario, the received signal at symbol block $n$ is
		\begin{equation}
			y[n] = \sqrt{P} h_{\mathrm{D}} s[n] + \sum_k \sqrt{\alpha_k} h_{\mathrm{C},k} c_k \sqrt{P} s[n] + w[n].
		\end{equation}

		On the one hand, we can compute the \emph{sum-rate} of the tags and characterize the (ergodic) primary-secondary capacity region by adjusting weight $\rho$. The weighted sum-rate can be expressed as
		\begin{align}
			J_1
			& = \rho \mathbb{E}_{\boldsymbol{c}} \left[ \log_2 \left( 1 + \gamma \lvert h_{\mathrm{D}} + \sum_k \sqrt{\alpha_k} h_{\mathrm{C},k} c_k \rvert \right) \right] + (1 - \rho) R_c\\
			& = \rho \sum_{i_1,\dots,i_K \in \mathcal{M}} \prod_{k \in \mathcal{K}} r_{k,i_k} \log_2 \left( 1 + \gamma \lvert h_{\mathrm{D}} + \sum_{k' \in \mathcal{K}} \sqrt{\alpha_{k'}} h_{\mathrm{C},k'} c_{k',i_{k'}} \rvert^2 \right)\\
			& \quad + (1 - \rho) \sum_{i \in \mathcal{M}} \sum_{j \in \mathcal{M}^K} \sum_{k \in \mathcal{K}} r_{k,i} p_{i,j} \log \frac{q_{j,i}}{r_{k,i}}.
		\end{align}
		In this case, although we can independently maximize the primary/secondary rate in closed form (resp. quantized IRS and multi-user Blahut-Arimoto), the joint form can be tricky due to the $K$-product term. We may consider a 2-loop iterative algorithm, where the inner loop optimizes input distribution over letters while the outer loop over users. I am still working on the convergence and optimality proofs and they are very deep into information theory.

		On the other hand, we can compute the rate region of the user and $K$ tags. However, the capacity region of discrete MAC remains unknown. We can obtain its outer bound by formulating a non-convex problem with a rank-1 constraint, then solve the relaxed problem. The difficulty is that the optimization is performed over $K$-dimensional array $\mathbb{R}^{\underbrace{M \times \ldots \times M}_{K}}$.
	\end{section}


	\begin{appendix}
		\begin{subsection}{Proof of Theorem~\ref{th:backward_transition}}
			Denote the objective function \eqref{ob:weighted_sum_rate_expanded} as $R(\boldsymbol{r}, \boldsymbol{Q})$. Let $w_j \triangleq \sum_{i'} r_{i'} p_{i', j}$ and rearrange \eqref{eq:backward_transition} as
			\begin{equation}
				w_j q_{j, i}^{\star} = r_i p_{i, j}.
			\end{equation}
			Therefore,
			\begin{align}
				R(\boldsymbol{r}, \boldsymbol{Q}^{\star}) - R(\boldsymbol{r}, \boldsymbol{Q})
				& = (1 - \rho) \sum_{i \in \mathcal{M}} \sum_{j \in \mathcal{M}} r_i p_{i, j} \log_2 \frac{q_{j, i}^{\star}}{q_{j, i}} \nonumber \\
				& = (1 - \rho) \sum_{i \in \mathcal{M}} \sum_{j \in \mathcal{M}} w_j q_{j, i}^{\star} \log_2 \frac{q_{j, i}^{\star}}{q_{j, i}} \nonumber \\
				& = (1 - \rho) \sum_{j \in \mathcal{M}} w_j \sum_{i \in \mathcal{M}} q_{j, i}^{\star} \log_2 \frac{q_{j, i}^{\star}}{q_{j, i}} \nonumber \\
				& = (1 - \rho) \sum_{j \in \mathcal{M}} w_j \infdiv{q_{j, i}^{\star}}{q_{j, i}} \nonumber \\
				& \ge 0,
			\end{align}
			with equality iff $\boldsymbol{Q} = \boldsymbol{Q}^{\star}$.
			\label{ap:backward_transition}
		\end{subsection}
		\begin{subsection}{Proof of Theorem~\ref{th:input_distribution}}
			We employ the method of Lagrange multipliers, temporally ignore the constraint $\boldsymbol{r} \ge 0$, and assume all logarithms are of base $e$. Define the Lagrangian function as
			\begin{align}
				J
				& = \rho \sum_{i \in \mathcal{M}} r_i \log \bigl( 1 + \gamma \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_i \rvert^2 \bigr) \nonumber \\
				& \quad + (1 - \rho) \sum_{i \in \mathcal{M}} \sum_{j \in \mathcal{M}} r_i p_{i, j} \log \frac{q_{j, i}}{r_i} + \lambda \left( 1 - \sum_{i \in \mathcal{M}} r_i \right),
			\end{align}
			where $\lambda$ is the Lagrange multiplier associated with the sum-probability constraint. Differentiating $J$ with respect to $r_i$ gives
			\begin{align}
				\pdv{J}{r_i}
				& = \rho \log \bigl( 1 + \gamma \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_i \rvert^2 \bigr) \\
				& \quad + (1 - \rho) \left( \sum_{j \in \mathcal{M}} p_{i, j} \log q_{j, i} - \log r_i - 1 \right),
			\end{align}
			and setting $\pdv*{J}{r_i} = 0$ suggests
			\begin{equation}
				r_i = e^{ -(\frac{\lambda}{1 - \rho} + 1)} \bigl( 1 + \gamma \lvert h_{\mathrm{D}} + \sqrt{\alpha} h_{\mathrm{C}} c_i \rvert^2 \bigr)^{\rho / (1 - \rho)} \prod_{j \in \mathcal{M}} q_{j, i}^{p_{i, j}}.
			\end{equation}
			By considering $\sum_{i \in \mathcal{M}} r_i = 1$, we can eliminate $\lambda$ and obtain the optimal tag input distribution as \eqref{eq:input_distribution}.
			\label{ap:input_distribution}
		\end{subsection}
	\end{appendix}

	\bibliographystyle{IEEEtran}
	\bibliography{IEEEabrv,library.bib}
\end{document}
